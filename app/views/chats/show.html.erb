<div class="container-fluid">
  <%# The row of the page %>
  <div class="row" data-controller="toggle">
    <%# The columns of the page %>

    <%# render the sidebar column %>
    <%= render "shared/sidebar", chats: @chats, cv: @cv %>

    <div class="col-md-11 pt-3" data-toggle-target="contentCol">
      <%# The page content goes here %>

      <h1 class="text-center"><%= @chat.title %></h1>

      <div class="row">
        <div class="col-5">
          <h2 class="mb-4">What we have so far:</h2>
          <p>Title: <%= @cv.title %></p>

            <%= simple_form_for(@cv, html: { class: "cv-form", turbo_method: :patch }) do |f| %>
              <%= f.input :content, required: true, input_html: { class: "auto-expand", rows: 18 } %>
              <%= f.submit "Update CV", class: "btn btn-primary" %>
            <% end %>

        </div>
        <div class="col-6">

          <h3>Chat with Sensei</h3>
          <div class="container overflow-y-auto" style="height: 300px;">

            <% @messages.each do |m| %>
              <% if m.role == "user" %>
                <div class="d-flex justify-content-end mb-2">
                  <div class="px-3 pb-0 pt-3 rounded-pill text-dark bg-white">
                    <%= raw(render_markdown(m.content)) %>
                  </div>
                </div>
              <% else %>
                <div class="d-flex justify-content-start mb-5 text-primary">
                  <div class="px-3 pb-0 pt-3">
                    <%= raw(render_markdown(m.content)) %>
                  </div>
                </div>
              <% end %>
            <% end %>

          </div>
          <h3>Create a new message</h3>
          <div class="form-inputs" data-bs-theme="light">
            <%= simple_form_for [@chat, @message] do |form| %>
              <%= form.input :content %>
              <%= form.submit class: "btn btn-primary" %>
            <% end %>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>
